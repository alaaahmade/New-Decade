import{I as r,be as Z,b2 as _,ak as N,bh as g,a9 as s,ae as q,b3 as ss,ao as es,ag as as,bj as h,a$ as ts,bg as os,al as rs,b8 as ns,am as is,ai as ds}from"./index-7baedad1.js";import{G as d,o as ls,C as cs}from"./yup-573c9287.js";import"./axios-cb1c23e4.js";import{u as ms,c as us,a as l,b as ps,d as hs,R as c,F as xs,C as ws}from"./form-provider-f0797274.js";import{C as fs}from"./confirm-dialog-d5828f7f.js";import{L as V}from"./LoadingButton-5b466cf8.js";import{C as gs}from"./numeral-64476a1d.js";import"./TextField-ea5a8ca7.js";import"./DialogTitle-47e8c009.js";function O({currentSettings:t}){const[m,b]=r.useState(!1),j=Z(),C=_("up","md"),[v,u]=r.useState(""),[U,x]=r.useState(!1),{user:js,setUser:$}=r.useContext(N);ms();const G=us().shape({name:l().min(4).max(50).required("name is required"),email:l().min(4).max(50).required("email is required"),password:l(),confirmPassword:l().oneOf([ps("password")],"Password's not match"),prevPassword:l()}),w=r.useMemo(()=>({name:(t==null?void 0:t.name)||"",email:(t==null?void 0:t.email)||"",password:"",confirmPassword:"",prevPassword:""}),[t]),y=hs({resolver:async(n,a,i)=>await ls(G)(n,a,i),defaultValues:w}),{reset:p,watch:z,setValue:P,handleSubmit:H,formState:{isSubmitting:W,isValid:Cs}}=y,o=z();r.useEffect(()=>{t&&p(w)},[t,w,p]);const J=async()=>{var n,a,i,f,k,E,F,R,A,B,D,I,L,T;try{if(x(!0),o.prevPassword.length>1&&o.prevPassword.length<7){u("Password must be mor than 7 character!");return}else if(o.prevPassword.length)u("");else{u("Enter password!");return}const{data:e}=await os.put("/auth/security",{password:o.prevPassword,newPassword:o.password||null,confirmPassword:o.confirmPassword||null,email:o.email,name:o.name});rs.setToken(e.token),$({id:(n=e==null?void 0:e.data)==null?void 0:n.userId,name:(a=e==null?void 0:e.data)==null?void 0:a.name,role:(i=e==null?void 0:e.data)==null?void 0:i.role,email:(f=e==null?void 0:e.data)==null?void 0:f.email}),g.success("user updated successfully."),x(!1),p(),j.push(h.dashboard.root)}catch(e){console.log(e),x(!1),(R=(F=(E=(k=e==null?void 0:e.response)==null?void 0:k.data)==null?void 0:E.data)==null?void 0:F.message)!=null&&R.includes("password")&&u((D=(B=(A=e==null?void 0:e.response)==null?void 0:A.data)==null?void 0:B.data)==null?void 0:D.message),g.error((T=(L=(I=e==null?void 0:e.response)==null?void 0:I.data)==null?void 0:L.data)==null?void 0:T.message)}},S=H(async n=>{try{b(!0)}catch(a){g.error(a.response.data.msg||"Something went wrong!"),console.error(a)}}),M=()=>{p(),b(!1)};r.useCallback(n=>{const a=n[0];setChangeCover(!0);const i=Object.assign(a,{preview:URL.createObjectURL(a)});setFile(a),a&&P("image",i,{shouldValidate:!0})},[P]);const Q=s.jsx(c,{error:v.length,helperText:v,type:"password",name:"prevPassword",label:"Password"}),K=s.jsx(V,{type:"submit",loading:U,sx:{ml:2,backgroundColor:"#212B36",color:"#fff"},onClick:J,children:"Save Changes"}),X=s.jsxs(s.Fragment,{children:[C&&s.jsxs(d,{md:4,children:[s.jsx(q,{variant:"h6",sx:{mb:.5},children:"Account Settings"}),s.jsx(q,{variant:"body2",sx:{color:"text.secondary"},children:"Name, Email, Password..."})]}),s.jsx(d,{xs:12,md:8,children:s.jsx(gs,{children:s.jsxs(ss,{spacing:3,sx:{p:3},children:[s.jsx(cs,{title:"Edit Settings"}),s.jsx(c,{name:"name",label:"Name"}),s.jsx(c,{name:"email",label:"Email"}),s.jsxs(es,{sx:{width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[s.jsx(c,{type:"password",name:"password",label:"new Password",sx:{width:"49%"}}),s.jsx(c,{type:"password",name:"confirmPassword",label:"Confirm Password",sx:{width:"49%"}})]})]})})})]}),Y=s.jsxs(s.Fragment,{children:[C&&s.jsx(d,{md:4}),s.jsxs(d,{xs:12,md:8,sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[s.jsx(as,{color:"inherit",variant:"outlined",size:"large",onClick:()=>j.push(h.dashboard.root),children:"cancel"}),s.jsx(V,{type:"button",variant:"contained",size:"large",loading:W,sx:{ml:2},onClick:async()=>{await S()},children:"Save Settings"})]})]});return s.jsxs(xs,{methods:y,onSubmit:S,children:[s.jsxs(d,{container:!0,spacing:3,children:[X,Y]}),s.jsx(fs,{title:"Are you sour to save changes",open:m,inputs:Q,action:K,onClose:M})]})}O.propTypes={currentSettings:ts.object};function bs(){const t=ns(),{user:m}=r.useContext(N);return s.jsxs(is,{maxWidth:t.themeStretch?!1:"lg",children:[s.jsx(ws,{heading:"Edit Account Sittings",links:[{name:"Dashboard",href:h.dashboard.root},{name:"sittings",href:h.dashboard.group.six}],sx:{mb:{xs:3,md:5}}}),m&&s.jsx(O,{currentSettings:m})]})}function Bs(){return s.jsxs(s.Fragment,{children:[s.jsx(ds,{children:s.jsx("title",{children:" Dashboard: Settings"})}),s.jsx(bs,{})]})}export{Bs as default};
