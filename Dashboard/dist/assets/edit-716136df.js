import{a$ as f,I as t,bJ as je,a9 as a,b3 as V,ae as U,ag as de,be,b2 as _e,bg as E,bh as ie,bj as ne,b8 as ge,am as ue,ai as we}from"./index-7baedad1.js";import{i as ye}from"./blog-ab74bd07.js";import{c as me,a as F,d as ce,F as pe,g as qe,u as Ce,e as oe,R as v,C as Fe}from"./form-provider-f0797274.js";import{o as xe,G as W,C as X}from"./yup-573c9287.js";import{d as Re,a as Se}from"./RemoveCircleOutline-7d32947f.js";import"./components.styled-0a52fcef.js";import{R as le,I as ke,j as he,k as De}from"./attributeReduce-55c83204.js";import{C as Te}from"./numeral-64476a1d.js";import{L as Ee}from"./LoadingButton-5b466cf8.js";import"./axios-cb1c23e4.js";import"./TextField-ea5a8ca7.js";import"./createSvgIcon-43748fa8.js";f.string,f.func;const te=({insights:e,insight:i,insightsDispatch:C,setAllValue:S,listName:D})=>{const{setCallBack:T}=t.useContext(je),[Z,$]=t.useState(null),[re,I]=t.useState(!1),L=me().shape({title:F().min(4).max(50).required("title is required"),description:F().min(10).max(5e3).required("Description is required"),link:F().min(4).max(50).required("link is required"),img:F().min(5).required("Image is required")}),A=t.useMemo(()=>({title:(i==null?void 0:i.title)||"",description:(i==null?void 0:i.description)||"",link:(i==null?void 0:i.link)||"",img:(i==null?void 0:i.img)||""}),[i]),H=ce({resolver:async(l,s,x)=>await xe(L)(l,s,x),defaultValues:A}),{reset:z,watch:B,setValue:r,handleSubmit:N,formState:{isSubmitting:se,isValid:G}}=H,O=B(),K=N(async l=>{});t.useEffect(()=>{i&&(z(A),T(K))},[i,A,z]);const M=l=>{l.preventDefault();const{value:s,id:x,name:c}=l.target,m=e.map(p=>p.id==x?{...p,[c]:s}:p);S(D,m),C({type:"edit",newInsights:m})},o=l=>{const{id:s}=l.target,x=e.filter(c=>c.id!=s);S(D,x),C({type:"remove",id:s,newInsights:x})},P=(l,s,x)=>{const c=l?l[0]:null,m=e.findIndex(d=>d.id==s.id),p=e.map((d,R)=>R===m?{...d,[x]:c}:d);S(D,p),C({type:"edit",newInsights:p,index:m})},ee=t.useCallback(l=>{const s=l[0];I(!0);const x=Object.assign(s,{preview:URL.createObjectURL(s)});$(s),s&&r("img",x,{shouldValidate:!0})},[r]),ae=t.useCallback(()=>{r("img",null),$(null)},[r]);return a.jsx(pe,{methods:H,onSubmit:K,children:a.jsxs(V,{spacing:3,sx:{p:3},children:[a.jsx(U,{variant:"subtitle2",children:O.name}),a.jsx(le,{id:i.id,onChange:M,name:"title",label:"Insight Title"}),a.jsx(le,{id:i.id,onChange:M,type:"text",name:"description",label:"Insight description",multiline:!0,rows:3}),a.jsx(le,{id:i.id,onChange:M,name:"link",label:"Insight Link"}),a.jsxs(V,{spacing:1.5,children:[a.jsx(U,{variant:"subtitle2",children:"Image"}),a.jsx(qe,{name:"img",maxSize:3145728,onDrop:l=>{P(l,i,"img"),ee(l)},onDelete:l=>{P(null,i,"img"),ae(l)},file:O.img||Z})]}),a.jsx(de,{id:i.id,variant:"outlined",sx:{color:"#FFFFFF",backgroundColor:"#b1a9a9","&:hover":{backgroundColor:"#b1a9a9",color:"red"}},startIcon:a.jsx(Re,{}),onClick:o,children:"Remove"})]})})};te.propTypes={insights:f.array.isRequired,insight:f.object.isRequired,insightsDispatch:f.func.isRequired,setAllValue:f.func.isRequired,listName:f.string.isRequired};const Y=({insights:e,insightsDispatch:i,setAllValue:C,listName:S})=>{const D=()=>{C(S,[...e,{id:e==null?void 0:e.length}]),i({type:"add",id:e==null?void 0:e.length})};return a.jsxs(a.Fragment,{children:[e==null?void 0:e.map(T=>a.jsx(te,{id:T.id,insight:T,insights:e,insightsDispatch:i,setAllValue:C,listName:S},T.id)),a.jsx(de,{variant:"outlined",sx:{color:"#fff",backgroundColor:"#212B36","&:hover":{backgroundColor:"#454F5B"}},startIcon:a.jsx(Se,{}),onClick:D,children:"إضافة طلب جديد"})]})};Y.propTypes={insights:f.array.isRequired,insightsDispatch:f.func.isRequired,setAllValue:f.func.isRequired,listName:f.string.isRequired};function fe({currentLatestInsights:e}){var l,s,x;const i=be(),C=_e("up","md"),{enqueueSnackbar:S}=Ce(),D=((l=e==null?void 0:e.lang)==null?void 0:l.ar.insights)||[],T=((s=e==null?void 0:e.lang)==null?void 0:s.en.insights)||[],Z=((x=e==null?void 0:e.lang)==null?void 0:x.cr.insights)||[],[$,re]=t.useReducer(ke,D),[I,L]=t.useReducer(he,T),[A,H]=t.useReducer(De,Z),z=me().shape({title_ar:F().min(4).max(50).required("العنوان مطلوب باللغة العربية"),title_en:F().min(4).max(50).required("English title is required"),title_cr:F().min(4).max(50).required("kurd title is required"),span_ar:F().min(4).max(50).required("الكلمة المميزة مطلوبة بالعربية"),span_en:F().min(4).max(50).required("English Special Word is required"),span_cr:F().min(4).max(50).required("kurd Special Word is required"),insights_ar:oe().min(1).max(5).required("Insights List مطلوب باللغة العربية"),insights_en:oe().min(1).max(5).required("English Insights List"),insights_cr:oe().min(1).max(5).required("Kurd Insights List")}),B=t.useMemo(()=>{var c,m,p,d,R,J,Q,n,j,b,_,g,u,w,y,q,k,h;return{title_ar:((m=(c=e==null?void 0:e.lang)==null?void 0:c.ar)==null?void 0:m.title)||"",title_en:((d=(p=e==null?void 0:e.lang)==null?void 0:p.en)==null?void 0:d.title)||"",title_cr:((J=(R=e==null?void 0:e.lang)==null?void 0:R.cr)==null?void 0:J.title)||"",span_ar:((n=(Q=e==null?void 0:e.lang)==null?void 0:Q.ar)==null?void 0:n.span)||"",span_en:((b=(j=e==null?void 0:e.lang)==null?void 0:j.en)==null?void 0:b.span)||"",span_cr:((g=(_=e==null?void 0:e.lang)==null?void 0:_.cr)==null?void 0:g.span)||"",insights_ar:((w=(u=e==null?void 0:e.lang)==null?void 0:u.ar)==null?void 0:w.insights)||"",insights_en:((q=(y=e==null?void 0:e.lang)==null?void 0:y.en)==null?void 0:q.insights)||"",insights_cr:((h=(k=e==null?void 0:e.lang)==null?void 0:k.cr)==null?void 0:h.insights)||""}},[e]),r=ce({resolver:async(c,m,p)=>await xe(z)(c,m,p),defaultValues:B}),{reset:N,watch:se,setValue:G,handleSubmit:O,formState:{isSubmitting:K,isValid:M}}=r,o=se();t.useEffect(()=>{e&&N(B)},[e,B,N]);const P=O(async c=>{var m,p;try{const d=await Promise.all(o==null?void 0:o.insights_ar.map(async(n,j)=>{var b,_,g,u,w,y;if(typeof n.img=="object"){(g=(_=(b=e==null?void 0:e.lang)==null?void 0:b.ar)==null?void 0:_.insights[j])!=null&&g.img&&await E.post("/deleteFile",{fileUrl:(y=(w=(u=e==null?void 0:e.lang)==null?void 0:u.ar)==null?void 0:w.insights[j])==null?void 0:y.img});const q=new FormData;if(n.img){q.append("file",n.img);const k=await E.post("/uploadFile/insights",q,{headers:{"Content-Type":"multipart/form-data"}}),{fileUrl:h}=k.data.data;n.img=h}}return n})),R=await Promise.all(o==null?void 0:o.insights_en.map(async(n,j)=>{var b,_,g,u,w,y;if(typeof n.img=="object"){(g=(_=(b=e==null?void 0:e.lang)==null?void 0:b.en)==null?void 0:_.insights[j])!=null&&g.img&&await E.post("/deleteFile",{fileUrl:(y=(w=(u=e==null?void 0:e.lang)==null?void 0:u.en)==null?void 0:w.insights[j])==null?void 0:y.img});const q=new FormData;if(n.img){q.append("file",n.img);const k=await E.post("/uploadFile/insights",q,{headers:{"Content-Type":"multipart/form-data"}}),{fileUrl:h}=k.data.data;n.img=h}}return n})),J=await Promise.all(o==null?void 0:o.insights_cr.map(async(n,j)=>{var b,_,g,u,w,y;if(typeof n.img=="object"){(g=(_=(b=e==null?void 0:e.lang)==null?void 0:b.cr)==null?void 0:_.insights[j])!=null&&g.img&&await E.post("/deleteFile",{fileUrl:(y=(w=(u=e==null?void 0:e.lang)==null?void 0:u.cr)==null?void 0:w.insights[j])==null?void 0:y.img});const q=new FormData;if(n.img){q.append("file",n.img);const k=await E.post("/uploadFile/insights",q,{headers:{"Content-Type":"multipart/form-data"}}),{fileUrl:h}=k.data.data;n.img=h}}return n})),Q={lang:{ar:{title:o==null?void 0:o.title_ar,span:o==null?void 0:o.span_ar,insights:d},en:{title:o==null?void 0:o.title_en,span:o==null?void 0:o.span_en,insights:R},cr:{title:o==null?void 0:o.title_cr,span:o==null?void 0:o.span_cr,insights:J}}};await E.put("/edit/insights",Q),N(),S("Update success!"),window.location.reload(),ie.success("Insights's Updated Successfully.")}catch(d){ie.error(((p=(m=d==null?void 0:d.response)==null?void 0:m.data)==null?void 0:p.msg)||"Something went wrong!"),console.error(d)}}),ee=a.jsxs(a.Fragment,{children:[C&&a.jsxs(W,{md:4,children:[a.jsx(U,{variant:"h6",sx:{mb:.5},children:"Texts"}),a.jsx(U,{variant:"body2",sx:{color:"text.secondary"},children:"Title, description, buttons..."})]}),a.jsx(W,{xs:12,md:8,children:a.jsxs(Te,{children:[!C&&a.jsx(X,{title:"Texts"}),a.jsx(X,{title:"Arabic Text"}),a.jsxs(V,{spacing:3,sx:{p:3},children:[a.jsx(v,{name:"title_ar",label:"العنوان بالعربية",sx:{direction:"rtl"}}),a.jsx(v,{name:"span_ar",label:"الكلمة المميزة بالعربية",sx:{direction:"rtl"}}),a.jsxs(V,{spacing:0,sx:{p:3},children:[a.jsx(U,{variant:"h6",sx:{mb:.5},children:"Insights"}),a.jsx(Y,{setAllValue:G,insights:$,insightsDispatch:re,listName:"insights_ar"})]}),a.jsx(X,{title:"English Text"}),a.jsx(v,{name:"title_en",label:"English title"}),a.jsx(v,{name:"span_en",label:"english Special Word"}),a.jsxs(V,{spacing:0,sx:{p:3},children:[a.jsx(U,{variant:"h6",sx:{mb:.5},children:"Insights"}),a.jsx(Y,{setAllValue:G,insights:I,insightsDispatch:L,listName:"insights_en"})]}),a.jsx(X,{title:"Kurd Text"}),a.jsx(v,{name:"title_cr",label:"kurd title"}),a.jsx(v,{name:"span_cr",label:"kurd Special Word"}),a.jsxs(V,{spacing:0,sx:{p:3},children:[a.jsx(U,{variant:"h6",sx:{mb:.5},children:"Insights"}),a.jsx(Y,{setAllValue:G,insights:A,insightsDispatch:H,listName:"insights_cr"})]})]})]})})]}),ae=a.jsxs(a.Fragment,{children:[C&&a.jsx(W,{md:4}),a.jsxs(W,{xs:12,md:8,sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[a.jsx(de,{color:"inherit",variant:"outlined",size:"large",onClick:()=>i.push(ne.dashboard.root),children:"cancel"}),a.jsx(Ee,{type:"button",variant:"contained",size:"large",loading:K,sx:{ml:2},onClick:async()=>{var c,m;await P(),(c=r==null?void 0:r.formState)!=null&&c.errors&&Object.keys((m=r==null?void 0:r.formState)==null?void 0:m.errors).map(d=>{var R;ie.error((R=r==null?void 0:r.formState)==null?void 0:R.errors[d].message)})},children:"Save Latest Insights"})]})]});return a.jsx(pe,{methods:r,onSubmit:P,children:a.jsxs(W,{container:!0,spacing:3,children:[ee,ae]})})}fe.propTypes={currentLatestInsights:f.object};function Ue(){const e=ge(),{latestInsights:i}=ye();return a.jsxs(ue,{maxWidth:e.themeStretch?!1:"lg",children:[a.jsx(Fe,{heading:"Edit Latest Insights Section",links:[{name:"Dashboard",href:ne.dashboard.root},{name:"Latest Insights",href:ne.dashboard.service.root}],sx:{mb:{xs:3,md:5}}}),i&&a.jsx(fe,{currentLatestInsights:i})]})}function Ke(){return a.jsxs(a.Fragment,{children:[a.jsx(we,{children:a.jsx("title",{children:" Dashboard: Latest Insights Edit"})}),a.jsx(Ue,{})]})}export{Ke as default};
